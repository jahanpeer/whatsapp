<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title></title>
</head>
<body>
  <script type="text/javascript">
    window.onload = function () {
      function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }

      var whatsappGroupLink = 'chat.whatsapp.com/';
      var excludeString = 'excludeString'; // The string you want to exclude
      var fallbackURL = getParameterByName('u');

      if (fallbackURL) {
        fallbackURL = fallbackURL.trim();

        // Check if the fallbackURL does NOT contain the excludeString
        if (!fallbackURL.includes(excludeString)) {
            
            if (!fallbackURL.includes(whatsappGroupLink)) {
              fallbackURL = 'https://' + whatsappGroupLink + fallbackURL ;
            }

            // Attempt to open the link in WhatsApp/WhatsApp Business first
            var whatsappURL = 'whatsapp://send?text=' + encodeURIComponent('Join my WhatsApp group: ' + fallbackURL);
            var whatsappBusinessURL = 'whatsapp://send?text=' + encodeURIComponent('Join my WhatsApp group: ' + fallbackURL);
            
            // Create an iframe to try to open the WhatsApp/WhatsApp Business app
            var iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = whatsappURL; // Change to whatsappBusinessURL for WhatsApp Business
            document.body.appendChild(iframe);
              
            // Use a timeout to fallback to opening the link in a browser if the app doesn't open
            setTimeout(function() {
              window.open(fallbackURL, '_self');
            }, 25);
        } else {
            // Log a message or handle the case where the excludeString is found in the URL.
            console.log("Excluded string found in URL, not redirecting.");
        }
      }
    };
  </script>
</body>
</html>
